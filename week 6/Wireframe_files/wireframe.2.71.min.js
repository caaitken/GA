$(function(){$canvas.offset();$(".editable").editnibble("hideAllEditors");$("#show-bg").hide();$("#canvas .txtcont span:empty").length&&$(".txtcont span:empty").text(paragraphtext);$("#canvas .listcont:empty").length&&$(".listcont:empty").each(function(){var a=$(this).parent().attr("data-color");$(this).html(list).find("li span").css({"background-color":a})});var a=0,b=0,c=$("#canvas .page:visible");$("#canvas .page").show();$("#canvas .wire").each(function(){b=$(this).offset().top+$(this).height();
b>a&&(a=b)});$("#canvas .page").hide();c.show();c=$canvas.height();600<c&&($(".container").css("overflow-y","auto"),c>=a?supercanvas.css("height",parseInt(c,10)+250+"px"):supercanvas.css("height",parseInt(a,10)+150+"px"));if(!$("#canvas #grid-div").length)switch($("#canvas").prepend($(".grids").show().contents().unwrap()),$("#show-grid").attr("checked",!0),$canvaswrap.attr("data-grid")){case "graph":$("#grid-div").show();$("#gridcol , #grid-dot").hide();$("select#grid-type").val("graph");break;case "dots":$("#grid-dot").show();
$("#gridcol , #grid-div").hide();$("select#grid-type").val("dots");break;case "col":$("#gridcol").show();$("#grid-div , #grid-dot").hide();$("select#grid-type").val("col");break;default:$("#grid-div , #grid-dot , #gridcol").hide(),$("#show-grid").attr("checked",!1)}$canvaswrap.hasClass("mobile")&&!$canvaswrap.hasClass("tablet")&&$(".device-mobile").insertBefore($(".device-window"));$canvaswrap.hasClass("mobile-landscape")&&$(".device-mobile-landscp").insertBefore($(".device-window"));$canvaswrap.hasClass("tablet")&&
$(".device-tablet").insertBefore($(".device-window"));imgs=$(".device-wrap span");$("#canvas .wire").has(".headlinetxt").addClass("hastext");$(".textnew.ui-draggable").draggable("destroy");$canvaswrap.center();$("#canvas .locked").draggable("destroy").resizable("destroy");$("#sitemaplist").sortable({placeholder:"ui-state-highlight",containmentType:"div.sitemap",start:function(a,b){$(document).data("oldpos",b.item.index())},stop:function(a,b){var c=b.item.index(),g=b.item.attr("data-pageid");console.log($(document).data("oldpos")+
" "+c);$(document).data("oldpos")>c?$("#canvas #"+g).insertBefore($("#canvas .page:eq("+c+")")):$(document).data("oldpos")<c&&$("#canvas #"+g).insertAfter($("#canvas .page:eq("+c+")"))}}).disableSelection("#sitemaplist li")});$("#canvas .wire").not("#canvas .wire:has(.wirejr)").css({"border-style":"solid"});if($("#canvas .page").length)var multipaged=!0;
var supercanvas=$(".supercanvas"),exporting=$(".exporting"),gridsize=0,imgs,wirePresent=!0,wirepanel=$("#wirepanel"),annotPresent=!0,offset_c=$("#canvas").offset(),cwidth=$("#canvas-wrap").width(),MIN_DISTANCE=6,guides=[],innerOffsetX,innerOffsetY,offseta1=$("#canvas").offset(),defbw=1,defstrcolor="#444",defbgcolor="white",clonewidth=0,cloneheight=0,$canvaswrap=$("#canvas-wrap"),$canvas=$("#canvas"),index_highest=0,sttngs=$(".settings span i"),sett=$(".settings"),$sitemapicon=$("#sitemap icon i"),
previewMode;$(".container").hasClass("preview")&&(previewMode=!0);
$(document).ready(function(){setgridsize();$(".left , .icon , .colorpicker , .brcolor , #show-border , .stroke_width , #edit , #edittxt , #front , #back , #show-bg , #lock , #unlock , .tooltip").tipsy({delayIn:600});$(".device-wrap span ").tipsy({delayIn:1E3,gravity:"nw"});$(document).keydown(function(a){var b=$(document.activeElement).hasClass("editingtext"),c=$(document.activeElement).hasClass("editor-form-element"),d=$(document.activeElement).hasClass("input"),e=$(".appriseInner").length,f=$ajaxlogin.is(":visible"),
g=$("#canvas .selected").length;if(8===a.keyCode&&!(b||c||d||e||g))return!1;8!==a.keyCode||!g||b||d||c||e||f||(a.preventDefault(),$("#canvas .selected").remove())});updateCanvasInput();previewMode||$(".aa").draggable().resizable({handles:"all"})});positionAA();function updateCanvasInput(){var a=parseInt($canvaswrap.width(),10),b=parseInt($canvaswrap.height(),10);$(".canvassize").html("<b>canvas</b>: "+a+"/"+b+"px");$("#canvas_w_val").val(a);$("#canvas_h_val").val(b)}
$("#show-grid").bind("click",function(){$(this).is(":checked")?"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid","graph")):"dots"==$("select#grid-type").val()?($("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$canvaswrap.attr("data-grid","dots")):($("#gridcol").show(),$canvaswrap.attr("data-grid","col"),$("#grid-div , #grid-dot").hide()):($("#grid-div , #gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid",0))});
$("#gridcol").is(":visible")||$("#grid-div").is(":visible")||$("#show-grid").removeAttr("checked");
$("select#grid-type").change(function(){"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid","graph")):"dots"==$("select#grid-type").val()?($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid","dots")):($("#gridcol").show(),gridsize=0,$("#grid-div , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid",
"col"))});function setgridsize(){gridsize=$canvaswrap.attr("snappy");0<gridsize?($(".grid-size-val").text(gridsize),$("#snap-to-grid").attr("checked",!0),updategrid(gridsize),$("#grid-slider").slider("value",gridsize)):"col"==gridsize?($("#snap-to-grid").attr("checked",!0),$("select#grid-type").val("col"),gridsize=0,updategrid("col")):(updategrid(20),$("#grid-slider").slider("value",20))}$("#empty").click(function(){!0===confirm("Do you want to clear the canvas?")&&(window.location="/")});imgs=$(".device-wrap span");
$(".device-mobile").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile").removeClass("browser-wrap , mobile-landscape , tablet").css({width:"320px",height:"480px"}).center(),$(".wire").resizable("option","maxWidth",320),offset_c=$("#canvas").offset(),supercanvas.css("height","100%"),updateCanvasInput(),imgs=$(".device-wrap span"))});
$(".device-tablet").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile , tablet").removeClass("browser-wrap , mobile-landscape").css({width:"728px",height:"1024px"}).center(),$(".container").css("overflow-y","auto"),supercanvas.css("height","1350px"),$(".wire").resizable("option","maxWidth",728),offset_c=$("#canvas").offset(),imgs=$(".device-wrap span"),updateCanvasInput())});
$(".device-window").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.removeClass("mobile , tablet , mobile-landscape").addClass("browser-wrap").css({width:"820px",height:"480px"}).center(),$(".wire").resizable("option","maxWidth",820),offset_c=$("#canvas").offset(),updateCanvasInput(),supercanvas.css("height","100%"),imgs=$(".device-wrap span"))});
$(".device-mobile-landscp").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile-landscape").removeClass("browser-wrap , mobile , tablet").css({width:"480px",height:"320px"}).center(),$(".wire").resizable("option","maxWidth",480),offset_c=$("#canvas").offset(),updateCanvasInput(),supercanvas.css("height","100%"),imgs=$(".device-wrap span"))});
$("#show-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").show();$("#hide-annotation").show();$(this).hide()});$("#hide-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").hide();$("#show-annotation").show();$(this).hide()});$("#edit-wire").click(function(){$("#canvas .selected").dblclick()});$("#lock").click(function(){lock()});
function lock(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");a.length&&!$("#canvas .selected.locked").length?(a.addClass("locked , icon-").draggable("destroy").resizable("destroy").click(function(){0==$("#canvas .brandnew").length&&($(this).addClass("selected"),$("#lock").addClass("pressed"))}),$("#lock").addClass("pressed")):$("#canvas .selected.locked").length&&($("#canvas .selected.locked").removeClass("locked icon-").unbind("click"),$("#lock").removeClass("pressed"),
makeDrag(a))}var $ajaxlogin=$("#ajaxlogin"),supports_pushState="pushState"in history;
$("#save").click(function(){$("#canvas .page:visible .selected").removeClass("selected");$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").removeClass("ui-re");$canvaswrap.resizable("destroy");var a=supercanvas.clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),b=encodeURIComponent(a),
c="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id"));c+=$(this).outerHTML()});var d=encodeURIComponent(c);$.ajax({type:"POST",url:"../save",data:{note:b,name:filename,aa:d},success:function(e){switch(e){case "login":localStorage.setItem(filename,a);localStorage.setItem(filename+"aa",c);$ajaxlogin.find(".wrongpass").hide();$ajaxlogin.show().submit(function(a){a.preventDefault();$.ajax({type:"POST",url:"../ps/ajaxlogin.php",data:$ajaxlogin.serialize(),
success:function(a){console.log(a);0==a?$ajaxlogin.find(".wrongpass").show():$.ajax({type:"POST",url:"../save",data:{note:b,name:filename,aa:d},success:function(){$(".saved").show().delay(600).fadeOut();MakeCanvasDrag();makeDrag($("#canvas .wire"));$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"});localStorage.removeItem(filename);localStorage.removeItem(filename+"aa");$ajaxlogin.hide();_paq.push(["trackGoal",3])}})}})});_paq.push(["trackGoal",2]);break;default:$(".saved").show().delay(600).fadeOut(),
MakeCanvasDrag(),makeDrag($("#canvas .wire")),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa")}},error:function(){localStorage.setItem(filename,a);localStorage.setItem(filename+"aa",c);MakeCanvasDrag();makeDrag($("#canvas .wire"));$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"});_paq.push(["trackGoal",1])}})});
$("#fork").click(function(){$("#canvas .page:visible .selected").removeClass("selected");$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").removeClass("ui-re");$canvaswrap.resizable("destroy");var a=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),a=encodeURIComponent(a),
b="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id"));b+=$(this).outerHTML()});var c=encodeURIComponent(b),d=$.now();$.post("../fork",{note:a,name:filename,aa:c,timestamp:d},function(){console.log(d);$(".saved").show().delay(600).fadeOut();MakeCanvasDrag();makeDrag($(".wire"));$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"})})});
$("#savefree").click(function(){var a=!0;$("#canvas .selected").removeClass("selected");$("#canvas .wire , #canvas .aa ").draggable("destroy").resizable("destroy").removeClass("ui-re");$canvaswrap.resizable("destroy");var b=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),b=encodeURIComponent(b);0===filename?filename=randomID(6):a=!1;supports_pushState?history.pushState({},
"filename","/"+filename):location.hash="#"+filename;$.post("save.php",{note:b,name:filename},function(){MakeCanvasDrag();a?($(".savedURL").html("http://wireframe.cc/"+filename),$(".save-wrap").fadeIn().delay(1600).fadeOut()):$(".saved").fadeIn().delay(600).fadeOut();makeDrag($("#canvas .wire"));makeDrag($("#canvas .aa"))})});$("#slogan").length||$(".controls").fadeIn();function showSaveButton(){$("#slogan").fadeOut("fast",function(){$(".controls").fadeIn();$("#links").addClass("linksmin")})}
function InstantShowSaveButton(){$("#slogan").hide();$("#links").addClass("linksmin");$("#demo").hide();$(".controls").show()}$(".orstart").click(InstantShowSaveButton);$(".closeannot , .closeURLpopup").click(function(){$(this).parent().remove();previewMode&&saveComment()});
function divClicked(a){$("#canvas").boxer("destroy");$(this).parent().addClass("latest");a=$(this).html().replace(/<br>/gi,"\n");var b=$("<textarea class='editingtext'/>");b.val($("<div />").html(a).text()).addClass("textareanow");$(this).replaceWith(b);b.focus();b.blur(editableTextBlurred);$(".latest .ok").show();$("textarea").autosize();$(".annotbox").addClass("textareainside");$(".ok").click(editableTextBlurred)}
function edittext(a){if(!previewMode){a.stopPropagation();activepage.boxer("destroy");$(this).closest(".text");$(this).parent().parent().parent().removeClass("selected").css("z-index",9999999);a=$(this).html().replace(/<br>/gi,"\n");var b=$("<textarea class='editingtext' tabindex='-1' ></textarea>");b.val($("<div />").html(a).text());$(this).replaceWith(b);b.focus();b.bind("blur",textblur);b.autosize()}}function focustext(){$(".latest .editingtext").focus()}
function textblur(){previewMode||useboxer();var a=multipaged?$("#canvas .page:visible .editingtext"):$("#canvas .editingtext");a.parent().parent().parent().css("z-index","auto");var b=a.val().replace(/\n/gi,"<br>"),c=$("<div>");""===b&&(b="...");c.html(b).addClass("textme");a.replaceWith(c);a=c.css("height");c.dblclick(edittext).closest(".wire").css({height:a,position:"absolute"});c.dblclick(edittext).closest(".wirejr").draggable("destroy")}$(".textme").dblclick(edittext);
function editableTextBlurred(){previewMode||useboxer();$(".textareanow").parent().removeClass("latest");var a=$(".textareanow").val().replace(/\n/gi,"<br>"),b=$("<div>");""===a&&(a="...");b.html(a);$(".textareanow").replaceWith(b);b.click(divClicked);$(".ok").hide();previewMode&&(saveComment(),b.parent().parent().draggable({cancel:".annotbox , .closeannot",cursor:"move"}).resizable({handles:"all"}))}$(".ok").click(editableTextBlurred);
$.widget("ui.boxer",$.extend({},$.ui.mouse,{_init:function(){this.element.addClass("ui-boxer");this.dragged=!1;this._mouseInit();this.helper=$(document.createElement("div")).css({background:"rgba(0,0,0,0.7)"}).addClass("ui-boxer-helper");$(".dim").html("<b>W</b>: 0px, <b>H</b>: 0px")},destroy:function(){this.element.removeClass("ui-boxer ui-boxer-disabled").removeData("boxer").unbind(".boxer");this._mouseDestroy();return this},_mouseStart:function(a){wirepanel.hide();!0==$("#show-grid").attr("checked")&&
"col"==$("select#grid-type").val()&&!0==$("#snap-to-grid").attr("checked")&&(guides=$.map($(".col"),computeColForElement));a.ctrlKey||a.shiftKey||a.metaKey||$("#canvas .selected").removeClass("selected");$("#canvas .latestwire").removeClass("latestwire");$("#lock , #group").removeClass("pressed");$(".blank").remove();this.opos=[a.pageX,a.pageY];if(!this.options.disabled){var b=this.options;this._trigger("start",a);$(b.appendTo).append(this.helper);this.helper.css({"z-index":1E3,position:"absolute",
left:a.clientX,top:a.clientY,width:0,height:0})}},_mouseDrag:function(a){this.dragged=!0;if(!this.options.disabled){var b=this.opos[0],c=this.opos[1],d=a.pageX,e=a.pageY;b>d&&c>e&&this.helper.addClass("selecting");if(b>d)var f=d,d=b,b=f;c>e&&(f=e,e=c,c=f);this.helper.css({left:b,top:c,width:d-b,height:e-c});this.helper.hasClass("selecting")||(f=0.1+(d-b)/cwidth,0.7<=f&&(f=0.7),this.helper.css({left:b,top:c,width:d-b,height:e-c}).css({background:"rgba(0,0,0,"+f+") url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIUlEQVQYV2NkYGCQBGJ08BxdgHGIKMTiF0wPgjwz2BUCADTeBYguWvyCAAAAAElFTkSuQmCC)"}));
$(".dim").html("<b>W</b>: "+parseInt(d-b-1,10)+"px, <b>H</b>: "+parseInt(e-c-1,10)+"px");this._trigger("drag",a);return!1}},_mouseStop:function(a){$(".dimnow").remove();this.dragged=!1;var b=this.opos[0],c=this.opos[1],d=a.pageX,e=a.pageY;if(b>d)var f=d,d=b,b=f;c>e&&(f=e,e=c,c=f);var g=$("#canvas").offset();$(".wirejr").each(function(){var a=parseInt($(this).css("zIndex"),10);a>index_highest&&(index_highest=a)});var f=b-g.left,h=c-g.top;clonewidth=d-b-2;cloneheight=e-c-2;if(0<gridsize){f=Math.round(f/
gridsize)*gridsize;h=Math.round(h/gridsize)*gridsize;clonewidth=Math.round(clonewidth/gridsize)*gridsize;cloneheight=Math.round(cloneheight/gridsize)*gridsize;var k=this.helper.clone().css({left:f,top:h,"z-index":index_highest+1,width:clonewidth,height:cloneheight}).removeClass("ui-boxer-helper").appendTo(this.element).addClass("brandnew blank");20<f?$(".dim").html("<b>W</b>: "+clonewidth+"px, <b>H</b>: "+cloneheight+"px"):$(".dim").html("<b>W</b>: 0px, <b>H</b>: 0px")}else if("col"==$("select#grid-type").val()&&
!0==$("#snap-to-grid").attr("checked"))if(20<clonewidth||20<cloneheight){b=function(a,b){for(var c=b[0],e=Math.abs(a-c),d=0;d<b.length;d++){var f=Math.abs(a-b[d]);f<e&&(e=f,c=b[d])}return c};guides1=[];guides2=[];for(c=0;c<guides.length;c+=2)guides1.push(guides[c]);for(c=1;c<guides.length;c+=2)guides2.push(guides[c]);f=b(f,guides1);clonewidth=b(d-g.left,guides2)-f;k=this.helper.clone().css({left:f,top:h,"z-index":index_highest+1,width:clonewidth,height:cloneheight}).removeClass("ui-boxer-helper").appendTo(this.element).addClass("brandnew blank");
20<clonewidth||20<cloneheight?$(".dim").html("<b>W</b>: "+clonewidth+"px, <b>H</b>: "+cloneheight+"px"):$(".dim").html("<b>W</b>: 0px, <b>H</b>: 0px")}else this.helper.remove();else g=0,$canvaswrap.hasClass("browser-wrap")||(g=1),k=this.helper.clone().css({left:f-g,top:h-g,"z-index":index_highest+1}).removeClass("ui-boxer-helper").appendTo(this.element).addClass("brandnew blank"),20<d-b?$(".dim").html("<b>W</b>: "+(d-b-1)+"px, <b>H</b>: "+(e-c-1)+"px"):$(".dim").html("<b>W</b>: 0px, <b>H</b>: 0px");
this._trigger("stop",a,{box:k});this.helper.removeClass("selecting").css("background","transparent").remove();return!1}}));$.extend($.ui.boxer,{defaults:$.extend({},$.ui.mouse.defaults,{appendTo:"body",distance:0})});var activepage=$("#1").length?$("#1"):$("#canvas");useboxer();
function useboxer(){activepage.boxer({cursor:"pointer",stop:function(a,b){if($(".brandnew").hasClass("selecting")){var c=multipaged?"#canvas .page:visible .wire":".wire";$(".brandnew").collision(c).not(".groupmember").addClass("selected").draggable("enable");$("#canvas .selected.locked").length&&0===$("#canvas .selected:not(.locked)").length&&$("#lock").addClass("pressed");$("#canvas .selected.grouped").length&&0===$("#canvas .selected:not(.grouped)").length&&$("#group").addClass("pressed");$("#canvas .brandnew").remove()}else if(b.box.height(),
c=b.box.width(),20<b.box.width()||20<b.box.height()){$("#icons").show().siblings().hide();aspect_ratio($("#canvas .blank"));$("#annotate").show();$("#textinput").removeClass("lasticon");var d=b.box.position(),e=d.top,d=d.left,f=$("#canvas-wrap").position(),e=e+f.top-40,g=wirepanel.width(),c=d+c/2-g/2+f.left;0>=c&&(c=0);wirepanel.css({top:e,left:c});wirepanel.show();$(".brandnew").length&&$("#wirepanel .icon").hover(function(){type=$(this).attr("elementtype");prepareWire();$("#wirepanel .icon").click(function(){insertWire()})})}else b.box.remove()}})}
function prepareWire(){var a=$(".brandnew"),b=a.height();a.removeAttr("class").addClass("wirejr brandnew blank latestwire").empty().css({background:defbgcolor,width:clonewidth-2*defbw+1,height:cloneheight-2*defbw+1,"border-width":defbw+"px","border-color":defstrcolor,color:defstrcolor});a.addClass("new").addClass(type).css("margin-top",0);"annotate"==type&&$(".brandnew.annotate").removeClass("wire").addClass("aa").append(annotationhtml).draggable({cancel:".annotbox , .closeannot",cursor:"move"});
"slider2"!=type&&"line_hor"!=type||a.addClass("resizeX");"slider"==type&&a.css("margin-top",b/2-3).removeClass("slider").addClass("slider2").append("<span>").find("span").css("background",defstrcolor);"line_hor"==type&&a.css("margin-top",b/2);"scrollh"==type&&a.css("margin-top",b/2-10);"paragraph"==type&&a.append(paragraph).find("span").css("background",defstrcolor);"textinput"==type&&a.removeClass("textinput").addClass("textinput2").append("<span>|</span>");"combobox"==type&&a.removeClass("combobox").addClass("combobox2").append("<span>&#9660;</span>");
"scrollh"==type&&a.removeClass("scrollh").addClass("scrollh2").append("<span class='arrL'>&#9664;</span>").append("<span >&#9654;</span>");"progressbar"==type&&a.removeClass("progressbar").addClass("progressbar2").append("<span></span>");"list"==type&&a.append(list).find("span").css("background",defstrcolor);"headlinetxt"==type&&a.addClass("lastheadline textnew").append(texthtml);a.hasClass("headline")&&$(".brandnew.headline").html(headtxt).find(".headtext span").css("background",defstrcolor);if(a.hasClass("image")){a.svg();
var b=a.width(),c=a.height(),d=a.svg("get");d.line(0,c,b,0,{"class":"line1",stroke:defstrcolor,strokeWidth:defbw});d.line(0,0,b,c,{"class":"line2",stroke:defstrcolor,strokeWidth:defbw});a.addClass("hasSVG")}}
function insertWire(){if($("#canvas .brandnew").length){if("annotate"!==type){var a=$(".brandnew");a.wrap("<div class='wire'></div>");var b=a.closest(".wire"),c=a.width(),d=a.height(),e=a.position(),f=e.top,e=e.left;$("#canvas .wirejr").not(".aa").each(function(){var a=parseInt($(this).css("zIndex"),10);a>index_highest&&(index_highest=a)});b.css({top:f,left:e,width:c+2*defbw,height:d+2*defbw});a.css("cssText","top: 0 !important;left: 0 !important;height:"+d+"px;width:"+c+"px;border-width:"+defbw+
"px;border-color:"+defstrcolor+";color:"+defstrcolor+";background:"+defbgcolor+";z-index:"+(index_highest+1)+";");a.is(".aa")&&a.css("z-index","5000").removeClass("wirejr");makeDrag(b)}else makeDrag($(".brandnew")),$(".brandnew").removeClass("wirejr").css("z-index",5E3);"headlinetxt"==type&&($(".brandnew").parent().addClass("hastext"),$(".textme").click(edittext),$(".thelatest").click(),$(".textnew.lastheadline").removeClass("lastheadline"));"annotate"==type&&($(".editme").click(divClicked),$(".thelatest").click(),
$(".closeannot").click(function(){$(this).parent().remove()}));$(".brandnew").removeClass("blank brandnew");wirePresent&&0<$(".wire").length&&(showSaveButton(),wirePresent=!1);wirepanel.fadeOut("fast")}}var type;$(".headlinetxt").click(function(){$(this).draggable({disabled:!1})}).dblclick(function(){$(this).draggable({disabled:!0})});
function makeDrag(a){$("#canvas .wire").mousedown(function(a){1==a.altKey&&($(this).draggable("option","helper","clone").removeClass("selected").addClass("altdrag"),$("#canvas").droppable({drop:function(a,b){saveState();var c=$(b.helper).clone().removeClass("ui-draggable-dragging");multipaged?c.appendTo(".page:visible").addClass("selected").removeClass("altdrag").find(".ui-resizable-handle").remove():c.appendTo("#canvas").addClass("selected").removeClass("altdrag").find(".ui-resizable-handle").remove();
makeDrag(c);c.find(".textme").bind("dblclick",edittext);$(".wire").draggable("option","helper","none");$("#canvas").droppable("destroy")}}))});a.filter(".locked").click(function(a){0==$("#canvas .brandnew").length&&0===$("#canvas .selected:not(.locked)").length&&($(this).addClass("selected"),$("#lock").addClass("pressed"))});var b;a.not(".groupmember , .wirejr , .locked").draggable({snap:".col ",start:function(a,e){$("#canvas .brandnew").remove();saveState();c=parseInt($(this).css("borderLeftWidth"),
10);$(".selected.locked").removeClass("selected");e.helper.data("draggableXY.originalPosition",e.position||{top:0,left:0});e.helper.data("draggableXY.newDrag",!0);!a.shiftKey&&2>$("#canvas .selected:not(.locked)").length&&$(".selected").removeClass("selected");b=$("#canvas .selected:not(.locked)");$(".dim").html("<b>W</b>: "+$(this).outerWidth()+"px, <b>H</b>: "+$(this).outerHeight()+"px");wirepanel.hide();b.children().removeClass("selected");posTopArray=[];posLeftArray=[];$(this).hasClass("selected")&&
b.each(function(a){thiscsstop=$(this).css("top");"auto"==thiscsstop&&(thiscsstop=0);thiscssleft=$(this).css("left");"auto"==thiscssleft&&(thiscssleft=0);posTopArray[a]=parseInt(thiscsstop,10);posLeftArray[a]=parseInt(thiscssleft,10)});begintop=$(this).offset().top;beginleft=$(this).offset().left;0==gridsize&&"col"==$("select#grid-type").val()&&!0==$("#snap-to-grid").attr("checked")?guides=multipaged?$.map($("#canvas .page:visible .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):
$.map($("#canvas .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):0==gridsize&&(guides=multipaged?$.map($("#canvas .page:visible .wire, #canvas").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas").not(this),computeGuidesForElement));innerOffsetX=a.pageX-this.offsetLeft;innerOffsetY=a.pageY-this.offsetTop},drag:function(a,c){if(a.shiftKey){var f=c.helper.data("draggableXY.originalPosition"),g=Math.abs(f.left-c.position.left),f=Math.abs(f.top-c.position.top),h=c.helper.data("draggableXY.newDrag");
c.helper.data("draggableXY.newDrag",!1);g=h?Math.max(g,f)===g:c.helper.data("draggableXY.xMax");c.helper.data("draggableXY.xMax",g);g&&$(this).draggable("option","axis","x");g||$(this).draggable("option","axis","y")}if($(this).hasClass("selected")){var k=$(this).offset().left-beginleft,x=$(this).offset().top-begintop;b.each(function(a){$(this).css("top",posTopArray[a]+x);$(this).css("left",posLeftArray[a]+k)})}if(0==gridsize){$("#canvas").offset();var v,u,s=MIN_DISTANCE+1,q=MIN_DISTANCE+1,t,m,f=$(this),
n=a.pageY-innerOffsetY,p=a.pageX-innerOffsetX,l=f.outerWidth()-1,r=f.outerHeight()-1,w;$.each(guides,function(a,b){"h"==b.type&&((w=Math.abs(n-b.y))<q&&(q=w,u=b,m=0),(w=Math.abs(n-b.y+r))<q&&(q=w,u=b,m=r));"v"==b.type&&((w=Math.abs(p-b.x))<s&&(s=w,v=b,t=0),(w=Math.abs(p-b.x+l))<s&&(s=w,v=b,t=l))});if(!a.shiftKey||a.shiftKey&&!g)q<=MIN_DISTANCE?($("#guide-h").css("top",u.y).show(),c.position.top=u.y-m):($("#guide-h").hide(),c.position.top=n+1);if(!a.shiftKey||a.shiftKey&&g)s<=MIN_DISTANCE?($("#guide-v").css("left",
v.x).show(),c.position.left=v.x-t):($("#guide-v").hide(),c.position.left=p+1)}if(0<gridsize){var g=c.position.left,f=c.position.top,l=$(this).outerWidth()-1,r=$(this).outerHeight()-1,h=c.position.left+l,y=c.position.top+r;snappedleft=Math.round(g/gridsize)*gridsize;snappedright=Math.round(h/gridsize)*gridsize;snappedtop=Math.round(f/gridsize)*gridsize;snappedbottom=Math.round(y/gridsize)*gridsize;g=Math.abs(snappedleft-c.position.left);f=Math.abs(snappedright-c.position.left-l);h=Math.abs(snappedtop-
c.position.top);y=Math.abs(snappedbottom-c.position.top-r);c.position.left=g<f?snappedleft:snappedright-l;c.position.top=h<y?snappedtop:snappedbottom-r}},stop:function(a,b){$("#guide-v, #guide-h").hide();$(this).hasClass("altdrag")?$(".altdrag").removeClass("selected altdrag"):$(this).addClass("selected");$(this).draggable("option","axis","none")}});var c=2;a.not(".groupmember , .wirejr , .locked").resizable({maxWidth:cwidth+1,autoHide:!1,start:function(a,b){var f=multipaged?$("#canvas .page:visible .selected"):
$("#canvas .selected");$("#guide-v , #guide-h").hide();handle=$(this).data("resizable").axis;saveState();c=parseInt(f.css("borderLeftWidth"),10);wirepanel.hide();$(this).removeClass("selected");0==gridsize&&"col"==$("select#grid-type").val()&&!0==$("#snap-to-grid").attr("checked")?guides=multipaged?$.map($(" #canvas .page:visible .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):0==gridsize&&(guides=
multipaged?$.map($("#canvas .page:visible .wire, #canvas").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas").not(this),computeGuidesForElement))},resize:function(a,b){if(0==gridsize){var f,g,h=MIN_DISTANCE+1,k=MIN_DISTANCE+1,x,v,u=b.position.top,s=b.position.left,q=b.size.width-1,t=b.size.height-1,m;$.each(guides,function(a,b){"h"==b.type&&((m=u-b.y)<k&&(m=u-b.y)>-1*k&&"s"!==handle&&"se"!==handle&&"sw"!==handle&&(k=m,g=b,v=0),(m=u-b.y+t)<k&&(m=u-b.y+t)>-1*k&&"n"!==handle&&"ne"!==
handle&&"nw"!==handle&&(k=m,g=b,v=t));"v"==b.type&&((m=s-b.x)<h&&(m=s-b.x)>-1*h&&"e"!==handle&&"ne"!==handle&&"se"!==handle&&(h=m,f=b,x=0),(m=s-b.x+q)<h&&(m=s-b.x+q)>-1*h&&"w"!==handle&&"nw"!==handle&&"sw"!==handle&&(h=m,f=b,x=q))});k<=MIN_DISTANCE&&("n"==handle||"ne"==handle||"nw"==handle)?($("#guide-h").css("top",g.y).show(),b.position.top=g.y-v,b.size.height+=k):k<=MIN_DISTANCE&&("s"==handle||"sw"==handle||"se"==handle)?($("#guide-h").css("top",g.y).show(),b.size.height-=k+2*c):h<=MIN_DISTANCE&&
("w"==handle||"sw"==handle||"nw"==handle)?($("#guide-v").css("left",f.x).show(),b.position.left=f.x-x,b.size.width+=h+1):h<=MIN_DISTANCE&&("e"==handle||"se"==handle||"ne"==handle)?($("#guide-v").css("left",f.x).show(),b.size.width-=h+2*c):$("#guide-v , #guide-h").hide()}if($(".ui-resizable-resizing").hasClass("svginside")){var n=b.size.width;$(".ui-resizable-resizing svg ").css("width",n);var p=b.size.height;$(".ui-resizable-resizing svg ").css("height",p)}if($(".ui-resizable-resizing").has("hasSVG")){var n=
$(".ui-resizable-resizing").width(),p=$(".ui-resizable-resizing").height(),l=$(".ui-resizable-resizing .line2").attr("stroke-width");$(".ui-resizable-resizing .line1").attr("x2",n-2*l);$(".ui-resizable-resizing .line1").attr("y1",p-2*l);$(".ui-resizable-resizing .line2").attr("x2",n-2*l);$(".ui-resizable-resizing .line2").attr("y2",p-2*l);$(".ui-resizable-resizing svg").attr("height",p-2*l);$(".ui-resizable-resizing svg").attr("width",n-2*l)}if(0<gridsize){var n=b.position.left,p=b.position.top,q=
b.size.width-1,t=b.size.height-1,l=b.position.left+q,r=b.position.top+t;snappedleft=Math.round(n/gridsize)*gridsize;snappedright=Math.round(l/gridsize)*gridsize;snappedtop=Math.round(p/gridsize)*gridsize;snappedbottom=Math.round(r/gridsize)*gridsize;Math.abs(snappedleft-b.position.left);Math.abs(snappedright-b.position.left-q);Math.abs(snappedtop-b.position.top);Math.abs(snappedbottom-b.position.top-t);"se"==handle&&(b.size.width=snappedright-n-2*c+1,b.size.height=snappedbottom-p-2*c+1);"e"==handle&&
(b.size.width=snappedright-n-2*c+1);"s"==handle&&(b.size.height=snappedbottom-p-2*c+1);"w"==handle&&(b.size.width=l-snappedleft-2*c+1,b.position.left=snappedleft);"n"==handle&&(b.size.height=r-snappedtop-2*c+1,b.position.top=snappedtop);"nw"==handle&&(b.size.height=r-snappedtop-2*c+1,b.position.top=snappedtop,b.size.width=l-snappedleft-2*c+1,b.position.left=snappedleft);"ne"==handle&&(b.size.height=r-snappedtop-2*c+1,b.position.top=snappedtop,b.size.width=snappedright-n-2*c+1);"sw"==handle&&(b.size.width=
l-snappedleft-2*c+1,b.position.left=snappedleft,b.size.height=snappedbottom-p-2*c+1)}$(".dim").html("<b>W</b>: "+(b.size.width+2*c-1)+"px, <b>H</b>: "+(b.size.height+2*c-1)+"px")},stop:function(a,b){$("#guide-v , #guide-h").hide();$(this).addClass("selected");if($(".ui-resizable-resizing").hasClass("svginside")){var c=b.size.width;$(".ui-resizable-resizing svg ").css("width",c);c=b.size.height;$(".ui-resizable-resizing svg ").css("height",c)}},snap:" .col ",handles:"all",autoHide:!0});a.each(function(){$(this).resizable("option",
"alsoResize",$(this).find(".wirejr"))});a.mouseover(function(b){var c;c=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");$.each(a,function(){$(this).bind("contextmenu",function(a){1==c.length&&c.removeClass("selected");$(this).addClass("selected")})});isover=!0;var f=$(this),g=!1;$(document).keydown(function(a){g||(g=!0,a.shiftKey&&!0==isover&&f.draggable("disable"))})}).mouseout(function(a){isover=!1;$(this).draggable("enable")});$(".grouped").length&&$(".grouped").resizable("destroy")}
var isover=!1;
function MakeCanvasDrag(){$("#canvas-wrap").resizable({minWidth:320,minHeight:320,start:function(a,b){wirepanel.hide();var c=$("#canvas").height();$("#canvas").css("width",cwidth+2);$("#canvas").css("height",c+2)},resize:function(a,b){cwidth=b.size.width;$(".canvassize").html("<b>canvas</b>: "+parseInt(b.size.width,10)+"/"+parseInt(b.size.height,10)+"px");320===cwidth&&($canvaswrap.addClass("mobile").removeClass("browser-wrap , mobile-landscape"),imgs.eq(1).insertBefore(imgs.eq(2)),imgs.eq(0).insertAfter(imgs.eq(2)),
$(".canvassize").html("<b>canvas</b>: "+$("#canvas").width()+"/"+$("#canvas").height()+"px"));320<cwidth&&($canvaswrap.removeClass("mobile , mobile-landscape").addClass("browser-wrap"),imgs.eq(0).insertBefore(imgs.eq(1)),imgs.eq(2).insertAfter(imgs.eq(1)),$(".canvassize").html("<b>canvas</b>: "+$("#canvas").width()+"/"+$("#canvas").height()+"px"));320===b.size.height&&($canvaswrap.addClass("mobile-landscape").removeClass("browser-wrap , mobile"),imgs.eq(2).insertBefore(imgs.eq(1)),imgs.eq(0).insertAfter(imgs.eq(1)),
$(".canvassize").html("<b>canvas</b>: "+$("#canvas").width()+"/"+$("#canvas").height()+"px"));$("#canvas").css("width","100%");$("#canvas").css("height","100%")},stop:function(a,b){cwidth=b.size.width;$canvaswrap.hasClass("mobile-landscape")&&(cwidth=480);$("#canvas .wire").resizable("option","maxWidth",cwidth);$(this).center();updateCanvasInput()},alsoResize:".container",handles:"se"}).draggable({handle:"#browser",cursor:"move",containment:".container",stop:function(a){80>parseInt($(this).css("top"),
10)&&$(this).transition({top:"110px"});offset_c=$("#canvas").offset()}});$canvaswrap.find(".ui-resizable-se").addClass("icon-resize-full")}MakeCanvasDrag();$("#del").click(function(){delnow()});function delnow(){saveState();$("#canvas .selected").not("#canvas-wrap").remove()}$("#edit").click(function(){$("#icons").show().siblings().hide();$('.icon[elementtype="headlinetxt"]').hide();positionwirepanel()});
function positionwirepanel(){offset_c=$("#canvas-wrap").position();var a=$("#canvas div.selected");a.height();var b=a.width(),c=a.position(),a=c.left,c=c.top+offset_c.top-45,d=wirepanel.width(),b=a+b/2-d/2+offset_c.left;0>=b&&(b=0);wirepanel.css({top:c,left:b}).show()}
function editme(a){a.length&&($("#edittxt").click(function(){a&&(a.hasClass("headlinetxt")||a.has(".headlinetxt"))&&a.find(".editable").dblclick();a&&(a.hasClass("textnew")||a.has(".textnew"))&&$("#canvas div.selected .textme").dblclick();wirepanel.hide()}),render_edit_menu(),positionwirepanel())}var copied;posTopArray=[];posLeftArray=[];$("#copy").click(function(){copynow()});$("#cut").click(function(){cutnow()});key("ctrl+c, command+c",function(){copynow()});key("ctrl+x, command+x",function(){cutnow()});
function copynow(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");a.addClass("copying").resizable("destroy").draggable("destroy");var b="";a.each(function(a){b+=$(this).outerHTML()});localStorage.setItem("clipboard",b);makeDrag(a);a.removeClass("selected , copying");$(".copied").fadeIn().delay(600).fadeOut()}
function cutnow(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");a.addClass("copying").resizable("destroy").draggable("destroy");var b="";a.each(function(a){b+=$(this).outerHTML()});localStorage.setItem("clipboard",b);$(".selected").remove();$(".copied").fadeIn().delay(600).fadeOut()}key("del, delete",function(){$("#canvas .selected:not(#canvas-wrap)").remove()});$("#paste").click(function(){paste()});key("ctrl+v, command+v",function(){paste()});
function paste(){saveState();if(multipaged){$("#canvas .page:visible .selected").removeClass("selected");var a=localStorage.getItem("clipboard");$("#canvas .page:visible").append(a);a=$("#canvas .page:visible .copying")}else $("#canvas .selected").removeClass("selected"),a=localStorage.getItem("clipboard"),$("#canvas").append(a),a=$("#canvas .copying");makeDrag(a.not(".headlinetxt").not(".locked"));$("#canvas .page:visible .copying.locked").length&&$("#canvas .page:visible .copying.locked").click(function(){$(this).addClass("selected");
$("#lock").addClass("pressed")});a.find(".textme").bind("dblclick",edittext);a.removeClass("copying")}$(".colorpicker").click(function(){var a=$(this).css("background-color");changeBackgroundColor(a)});$(".strokeweight").click(function(){changeBorderWidth($(this).attr("stroke"))});
function changeBorderWidth(a){saveState();var b=$(".selected").has(".wirejr").length?$(".selected").find(".wirejr"):$(".selected");b.css("box-sizing","content-box");var c=parseInt(b.css("borderLeftWidth"),10),d=b.width()-2*parseInt(a,10)+2*c,c=b.height()-2*parseInt(a,10)+2*c;b.css({width:d+"px",height:c+"px","border-width":a});b.css({width:d+"px",height:c+"px","border-width":a+"px"});b.hasClass("svginside")&&$(".selected svg *").css("stroke-width",a);b.hasClass("hasSVG")&&($(".selected svg line").attr("stroke-width",
a),$(".selected svg .line1").attr({y1:c,x2:d}),$(".selected svg .line2").attr({y2:c,x2:d}),$(".selected svg").attr({height:c,width:d}));$(".dim").html("<b>W</b>: "+(b.outerWidth()-1)+"px, <b>H</b>: "+(b.outerWidth()-1)+"px")}
$(".brcolor").click(function(){saveState();var a=$(".selected").has(".wirejr").length?$(".selected").find(".wirejr"):$(".selected");current_brcolor=$(this).css("border-left-color");a.css("border-color",current_brcolor);a.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor);a.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor)});
function changeBackgroundColor(a){saveState();var b=$(".selected").has(".wirejr").length?$(".selected").find(".wirejr"):$(".selected");b&&(b.css("background-color",a),b.hasClass("headline")&&b.find("span").css("background-color",a),b.hasClass("headlinetxt")&&b.find("span").css("color",a),b.hasClass("paragraph")&&b.find("span").css("background-color",a),b.hasClass("list")&&(b.find("span").css({"background-color":a,color:a}),b.attr("data-color",a)));b.hasClass("svginside")&&$(".selected .image *").css("background-color",
a)}function changeBorderColor(a){saveState();var b=$(".selected").has(".wirejr").length?$(".selected").find(".wirejr"):$(".selected");current_brcolor=a;b.css("border-color",current_brcolor);b.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor);b.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor)}$("#front").click(function(){bring_to_front()});
function bring_to_front(){saveState();if($(".selected").has(".wirejr").length)var a=$(".selected").find(".wirejr"),b=$(".wirejr");else a=$(".selected"),b=$(".wire");b.each(function(){var a=parseInt($(this).css("zIndex"),10);a>index_highest&&(index_highest=a)});a.css("z-index",index_highest+1)}$("#back").click(function(){send_to_back()});
function send_to_back(){saveState();var a=$(".selected").has(".wirejr").length?$(".selected").find(".wirejr"):$(".selected");$(".wirejr").each(function(){var a=parseInt($(this).css("zIndex"),10);$(this).css("z-index",a+1)});a.css("zIndex",1)}$("#backward").click(function(){send_backward()});function send_backward(){saveState();var a=$(".selected").has(".wirejr").length?$(".selected").find(".wirejr"):$(".selected"),b=parseInt(a.css("zIndex"),10);0>=b&&(b=1);a.css("z-index",b-1)}$("#forward").click(function(){bring_forward()});
function bring_forward(){saveState();var a=$(".selected").has(".wirejr").length?$(".selected").find(".wirejr"):$(".selected"),b=parseInt(a.css("zIndex"),10);a.css("z-index",b+1)}
function computeGuidesForElement(a){var b=$(a);b.is(".col")?(a=b.position(),ww=$("#canvas").width(),a.left+=0.01*ww):a=b.position();if(b.is(".col"))var c=b.width(),b=b.height()-1;else c=b.outerWidth()-1,b=b.outerHeight()-1;return[{type:"h",x:a.left,y:a.top},{type:"h",x:a.left,y:a.top+b},{type:"v",x:a.left,y:a.top},{type:"v",x:a.left+c,y:a.top}]}function computeColForElement(a){var b=$(a);a=b.position();ww=$("#canvas").width();a.left+=0.01*ww;b=b.width();return[a.left+1,a.left+b]}
function aspect_ratio(a){var b=a.width();a=a.height();b/=a;0.3<=b&&8>=b&&($(".icon.rect").show(),$(".icon:not(.rect)").hide());0.3>b&&($(".icon.vertical").show(),$(".icon:not(.vertical)").hide());8<b&&($(".icon.horizontal").show(),$(".icon:not(.horizontal)").hide());$("#annotate").hide();$("#textinput").addClass("lasticon")}
var $showbg=$(" #show-bg"),$strokes=$("#strokes"),$showborderbg=$("#show-border , #show-bg"),$colorpickers=$("#colorpickers"),$bordercolors=$("#bordercolors"),$edittxt=$("#edittxt"),$textalsz=$("#textalign , #textsize");
function render_edit_menu(){$("#icons").hide().siblings().not("#lock , #unlock , #linklist").show();$("#linklist").hide();var a=$("#canvas div.selected"),a=a.has(".wirejr").length?a.find(".wirejr"):a;$showbg.hide();a.hasClass("paragraph")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),$edittxt.hide());a.hasClass("list")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$("#textsize").show(),$("#textalign").hide(),$edittxt.hide());
a.hasClass("headlinetxt")||a.hasClass("paragraph")||a.hasClass("list")||($edittxt.hide(),$("#show-border").show(),$("#brind-back-front").show(),$colorpickers.show(),$bordercolors.hide(),$strokes.show(),$textalsz.hide());if(a.hasClass("headlinetxt")||a.hasClass("headline"))$strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),$edittxt.show()}$("#show-bg").click(function(){$("#colorpickers").show();$("#bordercolors").hide();$("#show-border").show();$("#show-bg").hide()});
$("#show-border").click(function(){$("#bordercolors").show();$("#colorpickers").hide();$("#show-border").hide();$("#show-bg").show()});$("#alignleft").click(function(){saveState();$("#canvas .selected").find("span").css("text-align","left")});$("#aligncenter").click(function(){saveState();$("#canvas .selected").find("span").css("text-align","center")});$("#alignright").click(function(){saveState();$("#canvas .selected").find("span").css("text-align","right")});
$("#alignjustify").click(function(){saveState();$("#canvas .selected").find("span").css("text-align","justify")});
$("#font-s").click(function(){saveState();$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"7px","line-height":"13px"});$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"7px","line-height":"13px"});$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"12px","line-height":"12px"});$("#canvas .selected.textnew , #canvas .selected .textnew").css({"font-size":"12px","line-height":"12px"});
$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span ").css({"font-size":"14px","line-height":"14px","margin-bottom":"2px"})});
$("#font-m").click(function(){saveState();$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"10px","line-height":"20px"});$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"10px","line-height":"20px"});$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"18px","line-height":"18px"});$("#canvas .selected.textnew , #canvas .selected .textnew").css({"font-size":"18px","line-height":"18px"});
$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span").css({"font-size":"22px","line-height":"22px","margin-bottom":"6px"})});
$("#font-l").click(function(){saveState();$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"18px","line-height":"36px"});$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"18px","line-height":"36px"});$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"28px","line-height":"28px"});$("#canvas .selected.textnew , #canvas .selected .textnew").css({"font-size":"28px","line-height":"28px"});
$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span ").css({"font-size":"28px","line-height":"28px","margin-bottom":"8px"})});jQuery.fn.center=function(a){a=a?this.parent():window;this.transition({left:($(a).width()-this.outerWidth())/2+$(a).scrollLeft()+"px","margin-left":"0"});return this};
var annotationhtml="<span class=annotbox><div class='editme thelatest'></div><button class=ok><i class=icon-ok></i> ok</button></span><div class=closeannot><i class=icon-remove></i></div>",texthtml="<span class='text'><div class='textme thelatest'></div></span>",paragraph="<span class=txtcont><span>Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iise mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.</span></span>",
paragraphtext="Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.",
list="<span class='listcont'><ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul></span>",
listhtml="<ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul>",
headtxt="<span class='headtext'><span>Lorem</span> <span>ipsum</span> <span>dolor</span> <span>sitammet</span> <span>quam</span> <span>Lorem</span> <span>ipsumdolor</span> <span>sitammet</span> <span>quam</span></span>",img="<svg id='imgwire' version='1.1' baseProfile='tiny'  xmlns='http://www.w3.org/2000/svg'  width='200px' height='100px' viewBox='0 0 200 100' preserveAspectRatio='none'><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='100' x2='200' y2='0'/><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='0' x2='200' y2='100'/></svg>";
function getRandomNumber(a){return Math.floor(Math.random()*a)}function getRandomChar(){return"0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ".substr(getRandomNumber(62),1)}function randomID(a){for(var b="",c=0;c<a;c++)b+=getRandomChar();return b}$("#watch-demo").click(function(){$(".panel").is(":visible")||demo0()});
function demo0(){$("#canvas").append("<div id='demo'><div class='demoinfo'>Click & drag to draw</div><div id='demobox' ></div><div id='democursor'><i class='icon-cursor'></i></div><div id='demopanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div id='demoeditpanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>");$("#demobox").css({width:"0",height:"0"}).removeAttr("class");$(".demoinfo").text("Click & drag to draw");
$("#demo").fadeIn("slow",demo1)}function demo1(){$("#democursor").animate({top:"40px",left:"20px"},1500,demo1a)}function demo1a(){$("#democursor").addClass("drag");demo2()}function demo2(){$("#demobox").delay(500).animate({width:"240px",height:"160px"},3500);$("#democursor").delay(500).animate({top:"200px",left:"260px"},3500,demo3)}function demo3(){$("#democursor").removeClass("drag");$("#demopanel").delay(500).show(0,demo4)}
function demo4(){$(".demoinfo").text("Select stencil");$("#democursor").delay(800).animate({top:"125px",left:"55px"},1500,demo5)}function demo4a(){demo5()}function demo5(){$("#demobox").addClass("demobox");$("#democursor").delay(800).animate({top:"125px",left:"80px"},500,demo5a)}function demo5a(){$("#demobox").addClass("round");$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5b)}
function demo5b(){$("#demobox").addClass("demoround");$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5c)}function demo5c(){$("#democursor").addClass("drag");demo5d()}function demo5d(){$("#demopanel").delay(300).hide(0,demo5e)}function demo5e(){$("#democursor").removeClass("drag");demo6()}function demo6(){$("#demopanel").delay(1500).hide(0,demo6a)}
function demo6a(){$(".demoinfo").text("Doubleclick to edit");$("#democursor").addClass("drag");$("#demopanel").delay(200).hide(0,demo6b)}function demo6b(){$("#democursor").removeClass("drag");demo6c()}function demo6c(){$("#demopanel").delay(200).hide(0,demo6d)}function demo6d(){$("#democursor").addClass("drag");$("#demopanel").delay(200).hide(0,demo6e)}function demo6e(){$("#democursor").removeClass("drag");$("#demoeditpanel").delay(400).show(0,demo7)}
function demo7(){$("#democursor").delay(800).animate({top:"125px",left:"178px"},500,demo7a)}function demo7a(){$("#demopanel").delay(500).hide(0,demo7b)}function demo7b(){$("#democursor").addClass("drag");$("#demobox").addClass("grey");demo7c()}function demo7c(){$("#demoeditpanel").delay(300).hide(0,demo7d)}function demo7d(){$("#democursor").removeClass("drag");demo8()}function demo8(){$("#demo").delay(1600).hide("slow")}previewMode?$("#canvas .publiccomment .annotbox div").click(divClicked):$("#canvas .annotbox div").click(divClicked);
var anyannot=$("#canvas .aa").length;0<anyannot&&$("#hide-annotation").show();var delay=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();$(window).resize(function(){delay(function(){$canvaswrap.center()},500)});
function updategrid(a){for(var b=0;5>b;b++){var c="#grid-pattern .lineV:eq("+[b]+")";$("#grid-pattern .lineH:eq("+[b]+")").attr({y1:[b+1]*a,y2:[b+1]*a,x2:5*a});$(c).attr({x1:[b+1]*a,x2:[b+1]*a,y2:5*a});$(".svgdot").attr({cx:a-0.5,cy:a-0.5})}$("#grid-pattern").attr({width:5*a,height:5*a});$("#dot-pattern").attr({width:a,height:a})}$("#grid-slider").slider({min:10,max:50,value:20,slide:function(a,b){$(".grid-size-val").text(b.value)},stop:function(a,b){updategrid(b.value);turngridon()}});
$("#snap-to-grid , #grid-type").change(function(){turngridon();$("#snap-to-grid").attr("checked")||($canvaswrap.attr("snappy",0),gridsize=0)});
function turngridon(){$("#snap-to-grid").attr("checked")&&("graph"==$("select#grid-type").val()?(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr("snappy",gridsize)):"dots"==$("select#grid-type").val()?(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr("snappy",gridsize)):"col"==$("select#grid-type").val()&&($canvaswrap.attr("snappy","col"),gridsize=0))}$canvaswrap.data("savedState",[]);$canvaswrap.data("savedUndo",[]);var historystate=$canvaswrap.data("savedState"),future=$canvaswrap.data("savedUndo");
function saveState(){historystate.unshift($canvas.html());2<historystate.length&&historystate.pop();$("#undo").hasClass("inactive")&&$("#undo").removeClass("inactive")}key("ctrl+z, command+z",function(a){a.preventDefault();restoreState(makeDragNow)});$("#undo").click(function(){restoreState(makeDragNow)});key("ctrl+y, command+y",function(a){a.preventDefault();redo(makeDragNow)});$("#redo").click(function(){redo(makeDragNow)});
function restoreState(a){if(0<historystate.length){var b=historystate[0];future.unshift($canvas.html());$canvas.html(b);console.log("rest");saveUndo();$canvaswrap.resizable("destroy");$("#canvas .wire, #canvas .aa , #canvas .publiccomment").resizable("destroy").draggable("destroy");$("#redo").hasClass("inactive")&&$("#redo").removeClass("inactive");MakeCanvasDrag();a()}else $("#undo").addClass("inactive")}
function makeDragNow(){historystate.shift();activepage=multipaged?$(".page:visible"):$("#canvas");useboxer();renderContextMenu();makeDrag($("#canvas .wire"));$("#canvas").mousemove(function(a){$(".coord").html("<b>X</b>: "+parseInt(a.pageX-offset_c.left,10)+" <b>Y</b>: "+parseInt(a.pageY-offset_c.top,10))})}function saveUndo(){4<future.length&&future.pop()}
function redo(a){0<future.length?($canvas.html(future[0]),useboxer(),$(".ui-resizable-handle").remove(),future.shift(),a()):$("#redo").addClass("inactive")}$("#canvas").mousemove(function(a){$(".coord").html("<b>X</b>: "+parseInt(a.pageX-offset_c.left,10)+" <b>Y</b>: "+parseInt(a.pageY-offset_c.top,10))});
sett.bind("click",function(a){wirepanel.hide();supercanvas.hasClass("slide-down")?supercanvas.removeClass("slide-down").delay(600).queue(function(a){sharebar.hide();sett.toggleClass("pressed");exportbtn.removeClass("pressed");supercanvas.toggleClass("slide-left");a()}):(sharebar.hide(),exportbtn.removeClass("pressed"),supercanvas.removeClass("slide-right , slide-down"),supercanvas.toggleClass("slide-left"),$(this).toggleClass("pressed "),$(this).find("i").toggleClass("icon-arrow-right"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"))});
$("select#def-stroke-width").change(function(a){defbw=$("select#def-stroke-width").val()});$("select#def-stroke-color").change(function(a){defstrcolor=$("select#def-stroke-color").val()});$("select#def-bg-color").change(function(a){defbgcolor=$("select#def-bg-color").val()});$("#canvas_w_val").change(function(){$canvaswrap.width(parseInt($(this).val(),10));$(".wire").resizable("option","maxWidth",$(this).val());updateCanvasInput();$canvaswrap.center()});
$("#canvas_h_val").change(function(){600<$(this).val()&&($(".container").css("overflow-y","auto"),supercanvas.css({height:parseInt($(this).val(),10)+250+"px"}));$canvaswrap.css("height",$(this).val()+"px");updateCanvasInput()});$("body").bind("keydown",handleKeys);
function handleKeys(a){if(!$ajaxlogin.is(":visible")){draggable=$("#canvas .selected");distance=1;0<gridsize&&(distance=gridsize);pTopArray=[];pLeftArray=[];37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode||a.ctrlKey||(saveState(),draggable.each(function(a){thiscsstop=$(this).css("top");thiscssleft=$(this).css("left");pTopArray[a]=parseInt(thiscsstop,10);pLeftArray[a]=parseInt(thiscssleft,10)}));switch(a.keyCode){case 37:draggable.each(function(a){$(this).css("left",pLeftArray[a]-distance)});
break;case 38:draggable.each(function(a){$(this).css("top",pTopArray[a]-distance)});break;case 39:draggable.each(function(a){$(this).css("left",pLeftArray[a]+distance)});break;case 40:draggable.each(function(a){$(this).css("top",pTopArray[a]+distance)});break;default:return!0}a.preventDefault()}}$("#group").click(function(){group_ungroup()});
function group_ungroup(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");a.hasClass("grouped")?a.hasClass("grouped")&&a.not("grouped")?(ungroup_elements($("#canvas .selected.grouped")),group_elements(a)):a.hasClass("grouped")&&!a.not("grouped")&&ungroup_elements($("#canvas .selected.grouped")):group_elements(a)}key("ctrl+g, command+g",function(a){a.preventDefault();group_elements($("#canvas .selected"))});
key("ctrl+shift+g, command+shift+g",function(a){a.preventDefault();ungroup_elements($("#canvas .selected.grouped"))});
function group_elements(a){if(1<a.length){var b=1E4,c=1E4,d=-1,e=-1;a.each(function(){var a=$(this).position(),f=$(this).width(),k=$(this).height();b=b<a.top?b:a.top;c=c<a.left?c:a.left;d=d>a.left+f?d:a.left+f;e=e>a.top+k?e:a.top+k});var f=Math.floor(99999*Math.random());a.draggable("destroy").resizable("destroy").css({position:"absolute"}).removeClass("selected").addClass("groupmember");a.wrapAll('<div  style="position:relative; top:-'+b+"px; left:-"+c+'px;"/>');a.parent().wrap('<div class="grouped wire" id='+
f+' style="position:absolute;top:'+b+"px; left:"+c+"px;width:"+(d-c+2)+"px;height:"+(e-b+2)+'px;"/>');a.parent().parent().addClass("selected");a=$("#"+f);makeDrag(a);a.resizable("destroy").click(function () {$(this).toggleClass('selected');});;$("#group").addClass("pressed")}}
function ungroup_elements(a){innerwire=a.find(".wire");a.not("grouped")||a.draggable("destroy").resizable("destroy");var b=a.position(),c=innerwire.parent().position();a.find(".groupmember").unwrap().unwrap();innerwire.each(function(){abspos=$(this).position();$(this).css({top:b.top+(abspos.top+c.top),left:b.left+(abspos.left+c.left)})});innerwire.removeClass("groupmember");makeDrag(innerwire);$("#group").removeClass("pressed")}
$("#align-top").click(function(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");if(1==a.length)a.css("top","1px");else{var b=1E4;a.each(function(){var a=$(this).position();b=b<a.top?b:a.top});a.css("top",b+"px")}});$("#align-left").click(function(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");if(1==a.length)a.css("left","1px");else{var b=1E4;a.each(function(){var a=$(this).position();b=b<a.left?b:a.left});a.css("left",b+"px")}});
$("#align-right").click(function(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");if(1==a.length){var b=$("#canvas").width(),c=a.width(),d=parseInt(a.css("borderWidth"),10);a.css("left",b-c-2*d+1+"px")}else{var e=-1;a.each(function(){var a=$(this).position(),b=$(this).width();e=e>a.left+b?e:a.left+b});a.each(function(){var a=$(this).width();$(this).css("left",e-a+"px")})}});
$("#align-bottom").click(function(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");if(1==a.length){var b=$("#canvas").height(),c=a.height(),d=parseInt(a.css("borderWidth"),10);a.css("top",b-c-2*d+1+"px")}else{var e=-1;a.each(function(){var a=$(this).position(),b=$(this).height();e=e>a.top+b?e:a.top+b});a.each(function(){var a=$(this).height();$(this).css("top",e-a+"px")})}});
$("#align-center").click(function(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");if(1==a.length){var b=$("#canvas").height(),c=a.height();a.css("top",b/2-c/2+"px")}else{var d=-1,e=1E3;a.each(function(){var a=$(this).position(),b=$(this).height();d=d>a.top+b?d:a.top+b;e=e<a.top?e:a.top});a.each(function(){var a=$(this).height();$(this).css("top",(d+e)/2-a/2+"px")})}});
$("#align-middle").click(function(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");if(1==a.length){var b=$("#canvas").width(),c=a.width();a.css("left",b/2-c/2+"px")}else{var d=-1,e=1E3;a.each(function(){var a=$(this).position(),b=$(this).width();d=d>a.left+b?d:a.left+b;e=e<a.left?e:a.left});a.each(function(){var a=$(this).width();$(this).css("left",(d+e)/2-a/2+"px")})}});
$("#dist-v").click(function(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected"),b=0;divide=a.length-1;obj=a;distrb=sortdivs(obj,"top");maxTop=distrb[0].val+distrb[0].div.height()/2;last=distrb.length-1;maxBottom=distrb[last].val+distrb[last].div.height()/2;$.each(distrb,function(){thisdiv=this.div;var a=thisdiv.height();thisdiv.css("top",maxTop+(maxBottom-maxTop)/divide*b-a/2+"px");b++})});
$("#dist-h").click(function(){var a=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected"),b=0;divide=a.length-1;obj=a;distrb=sortdivs(obj,"left");maxLeft=distrb[0].val+distrb[0].div.width()/2;last=distrb.length-1;maxRight=distrb[last].val+distrb[last].div.width()/2;$.each(distrb,function(){thisdiv=this.div;var a=thisdiv.width();thisdiv.css("left",maxLeft+(maxRight-maxLeft)/divide*b-a/2+"px");b++})});
function sortdivs(a,b){for(var c=[],d=0;d<a.length;d++)pos=a.eq(d).position(),"top"==b?c.push({div:a.eq(d),val:pos.top}):c.push({div:a.eq(d),val:pos.left});return c.sort(function(a,b){return a.val<b.val?-1:a.val>b.val?1:0})}
$("#align").click(function(){$(".align-icons").toggleClass("align-icons-visible");$("#arrange-icons").hasClass("arrange-icons-visible")||$(".align-icons").siblings().toggleClass("inactive");$(this).toggleClass("pressed");$("#arrange-icons").hasClass("arrange-icons-visible")&&($("#arrange-icons").removeClass("arrange-icons-visible"),$("#arrange").removeClass("pressed"))});
$("#arrange").click(function(){$("#arrange-icons").toggleClass("arrange-icons-visible");$(".align-icons").hasClass("align-icons-visible")||$("#arrange-icons").siblings().toggleClass("inactive");$(this).toggleClass("pressed");$(".align-icons").hasClass("align-icons-visible")&&($(".align-icons").removeClass("align-icons-visible"),$("#align").removeClass("pressed"))});$(".inner-btn , #align , #arrange , .pagename-wrap , .appriseInner").click(function(a){a.stopPropagation()});
key("b",function(){type="box";prepareWire();insertWire()});key("r",function(){type="roundbox";prepareWire();insertWire()});key("e",function(){type="elipse";prepareWire();insertWire()});key("i",function(){type="image";prepareWire();insertWire()});key("p",function(){type="paragraph";prepareWire();insertWire()});key("l",function(){type="list";prepareWire();insertWire()});key("h",function(){type="headline";prepareWire();insertWire()});
key("t",function(a){a.preventDefault();type="headlinetxt";prepareWire();insertWire()});key("a",function(a){a.preventDefault();type="annotate";prepareWire();insertWire()});key("g",function(a){a.preventDefault();type="line_hor";prepareWire();insertWire()});key("v",function(a){a.preventDefault();type="line_vert";prepareWire();insertWire()});key("s",function(a){a.preventDefault();type="slider";prepareWire();insertWire()});key("u",function(a){a.preventDefault();type="progressbar";prepareWire();insertWire()});
key("c",function(a){a.preventDefault();type="combobox";prepareWire();insertWire()});key("q",function(a){a.preventDefault();type="scrollh";prepareWire();insertWire()});key("y",function(a){a.preventDefault();type="scrollv";prepareWire();insertWire()});key("n",function(a){a.preventDefault();type="textinput";prepareWire();insertWire()});
key("6",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#111","border-color":"#111"}));$("#canvas .selected").length&&changeBackgroundColor("#111")});key("5",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#444","border-color":"#444"}));$("#canvas .selected").length&&changeBackgroundColor("#444")});
key("4",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#777","border-color":"#777"}));$("#canvas .selected").length&&changeBackgroundColor("#777")});key("3",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#aaa","border-color":"#aaa"}));$("#canvas .selected").length&&changeBackgroundColor("#aaa")});
key("2",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#ddd","border-color":"#ddd"}));$("#canvas .selected").length&&changeBackgroundColor("#ddd")});key("1",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#fff","border-color":"#fff"}));$("#canvas .selected").length&&changeBackgroundColor("#fff")});
key("7",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"tomato","border-color":"tomato"}));$("#canvas .selected").length&&changeBackgroundColor("tomato")});key("0",function(){$("#canvas .selected").length&&changeBackgroundColor("transarent")});key("alt+7",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderColor("tomato"))});key("alt+1",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderColor("white"))});
key("alt+2",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderColor("#ddd"))});key("alt+3",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderColor("#aaa"))});key("alt+4",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderColor("#777"))});key("alt+5",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderColor("#444"))});key("alt+6",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderColor("#111"))});
key("alt+0",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderColor("transparent"))});key("ctrl+1",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderWidth("1"))});key("ctrl+2",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderWidth("2"))});key("ctrl+3",function(a){$("#canvas .selected").length&&(a.preventDefault(),changeBorderWidth("4"))});
key("ctrl+a, command+a",function(a){a.preventDefault();multipaged?$(".page:visible .wire").not(".locked , .groupmember").addClass("selected"):$(".wire").not(".locked , .groupmember").addClass("selected")});key("esc",function(a){a.preventDefault();$(".selected").removeClass("selected")});
function renderContextMenu(){$("#canvas , #canvas .wire").contextPopup({title:"",items:[{label:"Copy",action:function(){copynow()},"short":"Ctrl+C"},{label:"Cut",action:function(){cutnow()},"short":"Ctrl+X"},{label:"Paste",action:function(){paste()},"short":"Ctrl+V"},{label:"Delete",action:function(){delnow()},"short":"Del"},null,{label:"Edit",action:function(){$(".selected").dblclick()},"short":"doubleclick"},null,{label:"Bring to front",action:function(){bring_to_front()},"short":"Ctrl+Shift+\u2191"},
{label:"Bring forward",action:function(){bring_forward()},"short":"Ctrl+\u2191"},{label:"Send to back",action:function(){send_to_back()},"short":"Ctrl+Shift+\u2193"},{label:"Send backward",action:function(){send_backward()},"short":"Ctrl+\u2193"},null,{label:"Lock / Unlock",action:function(){lock()},"short":"Ctrl+L"},{label:"Group / Ungroup",action:function(){group_ungroup()},"short":"Ctrl+G"},{label:"Link",action:function(){makeLink()},"short":"Ctrl+K"}]})}$(".container").hasClass("preview")||renderContextMenu();
key("ctrl+up, command+up",function(a){a.preventDefault();bring_forward()});key("ctrl+shift+up, command+shift+up",function(a){a.preventDefault();bring_to_front()});key("ctrl+shift+down, command+shift+down",function(a){a.preventDefault();send_to_back()});key("ctrl+down, command+down",function(a){a.preventDefault();send_backward()});key("ctrl+l, command+l",function(a){a.preventDefault();lock()});key("ctrl+k, command+k",function(a){a.preventDefault();makeLink()});var pagelist=$(".sitemap ul");
multipaged&&(pagelist.empty(),$(".page").each(function(){pagelist.append($("<li>").attr({"data-pageid":$(this).attr("id")}).append($(this).attr("data-pagename")).click(function(){make_page_active($(this).attr("data-pageid"))}));make_page_active($(".page:visible").attr("id"))}));
function add_new_page(){apprise("Enter new name",{verify:!0,input:!0},function(a){if(a){var b=$.now();$("#canvas").append("<div class='page' id='"+b+"' data-pagename='"+a+"'>");pagelist.append($("<li>").attr({"data-pageid":b}).append(a).click(function(){make_page_active($(this).attr("data-pageid"))}));make_page_active(b);$(".pagename-wrap").click()}else return!1})}$(".addpage").click(add_new_page);
function make_page_active(a){var b=$("[data-pageid="+a+"]"),c=b.text();$(".pagename").text(c);activepage.hide();activepage=$("#"+a);activepage.show().siblings(".page").hide();$(".sitemap li").removeClass("activepage");b.addClass("activepage");previewMode?(0==$("#canvas .page:visible").next(".page").length?$("#next").addClass("inactive"):$("#next").removeClass("inactive"),0==$("#canvas .page:visible").prev(".page").length?$("#prev").addClass("inactive"):$("#prev").removeClass("inactive")):useboxer();
wirepanel.hide();$("#canvas").show()}$(".sitemap li").click(function(){make_page_active($(this).attr("data-pageid"))});
$(".pagename-wrap").click(function(){wirepanel.hide();supercanvas.hasClass("slide-down")?supercanvas.removeClass("slide-down").delay(600).queue(function(a){sharebar.hide();$sitemapicon.toggleClass("icon-sitemap icon-arrow-left");exportbtn.removeClass("pressed");supercanvas.toggleClass("slide-right");a()}):(supercanvas.removeClass("slide-left , slide-down"),sett.removeClass("pressed"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sharebar.hide(),supercanvas.toggleClass("slide-right"),
$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"))});$("#delete-page").click(function(){1<$(".sitemap li").length?apprise("Are you sure?",{verify:!0},function(a){if(a)a=$(".sitemap .activepage").attr("data-pageid"),$(".sitemap .activepage , #"+a).remove(),a=$(".sitemap li").eq(0).attr("data-pageid"),make_page_active(a);else return!1}):apprise("You can't delete the only page in the project")});
$("#duplicate-page").click(function(){apprise("Enter new name",{verify:!0,input:!0},function(a){if(a){var b=$.now(),c=$(".sitemap .activepage").attr("data-pageid");$("#canvas").append("<div class='page' id='"+b+"' data-pagename='"+a+"'>");$("#"+b).append($("#"+c).html());makeDrag($("#"+b+" .wire"));$("#"+b+" .textme").bind("dblclick",edittext);pagelist.append($("<li>").attr({"data-pageid":b}).append(a).click(function(){make_page_active($(this).attr("data-pageid"))}));make_page_active(b,a)}else return!1})});
$("#rename-page").click(function(){apprise("Enter new name",{verify:!0,input:!0},function(a){if(a){var b=$(".sitemap .activepage"),c=b.attr("data-pageid");$("#"+c).attr("data-pagename",a);b.text(a);make_page_active(c,a)}else return!1})});$("#Link").click(function(){makeLink()});$("#preview").click(function(){preview()});$("#re-edit").click(function(){makeEditable();sttngs.removeClass("icon-arrow-right").addClass("icon-cog");sett.removeClass("pressed");$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap")});
function makeLink(){if($(".page").length){var a=$("#linkselect");a.empty();a.append($("<option>").append("None").attr("value",0));$(".sitemap ul li").each(function(){a.append($("<option>").append($(this).text()).attr("value",$(this).attr("data-pageid")))});var b=$("#canvas .page:visible .selected").attr("data-link");b&&$("#linkselect option[value="+b+"]").attr("selected",!0);$("#linklist").show().siblings().hide();positionwirepanel();wirepanel.show();a.change(function(){var a=$("#linkselect option:selected").attr("value");
$("#canvas .page:visible .selected").attr("data-link",a).addClass("icon-link");wirepanel.hide()})}else alert("You need to be a Premium user to make clickable wireframes.")}$(".linkmark").click(function(a){a.stopPropagation();$("#Link").click()});
function preview(){previewMode||($("#top").addClass("topup"),supercanvas.removeClass("slide-left , slide-right , slide-down"),exportbtn.removeClass("pressed"),$(".bottomright, #wirepanel").hide(),$("#canvas .page .wire").draggable("destroy").resizable("destroy").removeClass("ui-resizable-autohide"),$("#canvas").addClass("preview"),$("#canvas .ui-boxer").boxer("destroy"),$("#canvas .page").bind("click",highlightclickable),$("#canvas .page .wire[data-link]").bind("click",gotopage))}
var gotopage=function(a){a.stopPropagation();a=$(this).attr("data-link");0!=a&&make_page_active(a)};function highlightclickable(){var a=$("#canvas .page:visible .wire[data-link]");a.stop(!0,!0).addClass("hilite").delay(600).queue(function(b){a.removeClass("hilite")})}
function makeEditable(){$("#top").removeClass("topup");$(".bottomright").show();$("#canvas").removeClass("preview");makeDrag($(".wire").not(".headlinetxt"));$(".wire[data-link]").unbind("click",gotopage);$("#canvas .page").unbind("click",highlightclickable);useboxer()}
$(".png").click(function(){$("#canvas .page .wire , #canvas .page .aa").draggable("destroy").resizable("destroy");$canvaswrap.resizable("destroy");var a=$("#canvas").html(),a=encodeURIComponent(a),b=parseInt($("#canvas-wrap").width(),10)+2,c=parseInt($("#canvas-wrap").height(),10)+2;exporting.show();$.post("https://wireframe.cc/pro/export_png.php",{data:a,w:b,h:c},function(a){$("iframe").attr("src","https://wireframe.cc/pro/download.php?f="+a);MakeCanvasDrag();makeDrag($("#canvas .page .wire"));exporting.hide()})});
$(".pdf").click(function(){$("#canvas .page .wire , #canvas .page .aa  ").draggable("destroy").resizable("destroy");$canvaswrap.resizable("destroy");var a=$("#canvas").html(),a=encodeURIComponent(a),b=parseInt($("#canvas-wrap").width(),10)+2,c=parseInt($("#canvas-wrap").height(),10)+2;exporting.show();$.post("https://wireframe.cc/pro/export_pdf.php",{data:a,w:b,h:c},function(a){$("iframe").attr("src","https://wireframe.cc/pro/download1.php?f="+a);MakeCanvasDrag();makeDrag($("#canvas .page .wire"));
exporting.hide()})});var sharebar=$(".sharebar"),exportbtn=$(".export");
exportbtn.click(function(){exportbtn.toggleClass("pressed");$(".container").animate({scrollTop:"0px"},{complete:function(){console.log($("body").offset().top);supercanvas.hasClass("slide-left")||supercanvas.hasClass("slide-right")?supercanvas.removeClass("slide-left , slide-right").delay(600).queue(function(a){sharebar.show();$(this).toggleClass("slide-down");sett.removeClass("pressed");$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap");sttngs.removeClass("icon-arrow-right").addClass("icon-cog");
a()}):(sharebar.show(),supercanvas.toggleClass("slide-down"))}})});previewMode&&$("#canvas .ui-boxer").boxer("destroy");0==$("#canvas .page:visible").next(".page").length&&$("#next").addClass("inactive");0==$("#canvas .page:visible").prev(".page").length&&$("#prev").addClass("inactive");
$("#next").click(function(){$("#prev").removeClass("inactive");$(".page:visible").next(".page").length&&($("#canvas .page:visible").hide().next(".page").show(),$(".pagename").text($("#canvas .page:visible").attr("data-pagename")),$(".activepage").removeClass("activepage"),$("[data-pageid="+$("#canvas .page:visible").attr("id")+"]").addClass("activepage"),0==$("#canvas .page:visible").next(".page").length&&$(this).addClass("inactive"))});
$("#prev").click(function(){$("#next").removeClass("inactive");var a=$(".page:visible");a.prev(".page").length&&(a.hide().prev(".page").show(),$(".pagename").text($("#canvas .page:visible").attr("data-pagename")),$(".activepage").removeClass("activepage"),$("[data-pageid="+$("#canvas .page:visible").attr("id")+"]").addClass("activepage"),0==$("#canvas .page:visible").prev(".page").length&&$(this).addClass("inactive"))});
$(".addComment").click(function(){$("#canvas .page:visible").append($("<div class='publiccomment'/>").css({width:"160px",height:"120px",top:"40px",left:"60px","z-index":5E3,position:"absolute"}).append(annotationhtml));$(".editme").click(divClicked);$("#canvas .thelatest").click();$("#canvas .closeannot").click(function(){$(this).parent().remove();saveComment()})});var $savecomment=$(".saveComment");
function saveComment(){$savecomment.show();console.log("ready to save");$savecomment.bind("click",function(){$("#canvas .page .publiccomment ,#canvas .page .aa").resizable("destroy").draggable("destroy");var a="";$("#canvas .page .publiccomment , #canvas .page .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id"));a+=$(this).outerHTML()});var b=encodeURIComponent(a);$.post("../savecomment",{pblcaa:b,preview:previewid},function(){$(".saved").show().delay(600).fadeOut();$("#canvas .page .publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"all",
stop:function(){saveComment()}});$savecomment.unbind("click");$savecomment.hide();console.log("saved")})})}function positionAA(){$(".publiccomment , .aa").each(function(){$(this).appendTo($("#"+$(this).attr("data-parent")))});$(".publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"all",stop:function(){saveComment()}})}
supercanvas.click(function(){if(supercanvas.hasClass("slide-left")||supercanvas.hasClass("slide-right")||supercanvas.hasClass("slide-down"))supercanvas.removeClass("slide-left , slide-right , slide-down"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed")});$(document).keyup(function(a){27==a.keyCode&&(wirepanel.hide(),$(".blank").remove())});
jQuery.fn.outerHTML=function(a){return a?this.before(a).remove():jQuery("<p>").append(this.eq(0).clone()).html()};window._link_was_clicked=!1;window.onbeforeunload=function(a){if(!window._link_was_clicked&&$("#canvas .wire").length&&"example"!=filename&&"examplemobile"!=filename)return"Are you sure?"};jQuery(document).bind("click","a",function(a){window._link_was_clicked=!0});$.fn.hasAttr=function(a){return void 0!==this.attr(a)};
jQuery.fn.htmlClean=function(){this.contents().filter(function(){if(3!=this.nodeType)return $(this).htmlClean(),!1;this.textContent=$.trim(this.textContent);return!/\S/.test(this.nodeValue)}).remove();return this};